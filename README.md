## AI Research Assistant API

This project provides an API layer for an AI research assistant that uses:

*   **LangChain**: For building the AI workflow
*   **Tavily**: For web search capabilities
*   **Gemini AI**: For natural language processing
*   **CopilotKit**: For frontend integration

## Features

*   **Natural Language Queries**: Users can ask questions in natural language
*   **Web Search Integration**: Uses Tavily to search the web for relevant information
*   **Image Analysis**: Can process and analyze attached images using Gemini AI
*   **Source Attribution**: Provides sources for information gathered from the web
*   **Real-time Streaming**: Delivers AI responses in real-time as they're generated, reducing perceived latency

## API Endpoints

### `/api/query`

Processes user queries with optional image attachments and web search capabilities.

**Request Body:**

```plaintext
{
  "query": "Your question here",
  "attachment": "Base64 encoded image (optional)",
  "searchEnabled": true/false
}
```

**Response:**

```plaintext
{
  "answer": "AI-generated response",
  "sources": ["https://source1.com", "https://source2.com"]
}
```

**Streaming Support:**  
To receive streaming responses, include the `Accept: text/event-stream` header in your request. The response will be a stream of text chunks that can be displayed incrementally to the user.

## Environment Variables

The following environment variables are required:

```plaintext
GEMINI_API_KEY=your_gemini_api_key
TAVILY_API_KEY=your_tavily_api_key
APPWRITE_API_KEY=your_appwrite_api_key
APPWRITE_PROJECT_ID=your_appwrite_project_id
APPWRITE_ENDPOINT=your_appwrite_endpoint
```

## Getting Started

1.  Clone the repository
2.  Install dependencies with `npm install`
3.  Create a `.env` file with the required environment variables
4.  Run the development server with `npm run dev`

## Tech Stack

*   **Next.js**: React framework for the frontend and API routes
*   **TypeScript**: For type safety
*   **LangChain**: For building AI workflows
*   **Tavily**: For web search capabilities
*   **Gemini AI**: For natural language processing
*   **CopilotKit**: For frontend integration

## Performance Optimizations

### Streaming Responses

This application implements streaming responses to improve user experience:

*   **Reduced Perceived Latency**: Users see partial responses immediately instead of waiting for the complete answer
*   **Real-time Feedback**: Visual indicators show that the system is actively generating a response
*   **Seamless Experience**: All features (web search, image analysis) work with streaming enabled

To toggle streaming on/off, use the "Enable streaming" checkbox in the UI.  
  
\<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 370.85626220703125 616.4000244140625" style="max-width: 370.85626220703125px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1751250932036-09icc3j1g">\<style>#mermaid-svg-1751250932036-09icc3j1g{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1751250932036-09icc3j1g .error-icon{fill:#bf616a;}#mermaid-svg-1751250932036-09icc3j1g .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1751250932036-09icc3j1g .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1751250932036-09icc3j1g .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1751250932036-09icc3j1g .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1751250932036-09icc3j1g .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1751250932036-09icc3j1g .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1751250932036-09icc3j1g .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1751250932036-09icc3j1g .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1751250932036-09icc3j1g svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1751250932036-09icc3j1g .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1751250932036-09icc3j1g .cluster-label text{fill:#ffffff;}#mermaid-svg-1751250932036-09icc3j1g .cluster-label span,#mermaid-svg-1751250932036-09icc3j1g p{color:#ffffff;}#mermaid-svg-1751250932036-09icc3j1g .label text,#mermaid-svg-1751250932036-09icc3j1g span,#mermaid-svg-1751250932036-09icc3j1g p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1751250932036-09icc3j1g .node rect,#mermaid-svg-1751250932036-09icc3j1g .node circle,#mermaid-svg-1751250932036-09icc3j1g .node ellipse,#mermaid-svg-1751250932036-09icc3j1g .node polygon,#mermaid-svg-1751250932036-09icc3j1g .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1751250932036-09icc3j1g .flowchart-label text{text-anchor:middle;}#mermaid-svg-1751250932036-09icc3j1g .node .label{text-align:center;}#mermaid-svg-1751250932036-09icc3j1g .node.clickable{cursor:pointer;}#mermaid-svg-1751250932036-09icc3j1g .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1751250932036-09icc3j1g .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1751250932036-09icc3j1g .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1751250932036-09icc3j1g .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1751250932036-09icc3j1g .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1751250932036-09icc3j1g .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1751250932036-09icc3j1g .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1751250932036-09icc3j1g .cluster text{fill:#ffffff;}#mermaid-svg-1751250932036-09icc3j1g .cluster span,#mermaid-svg-1751250932036-09icc3j1g p{color:#ffffff;}#mermaid-svg-1751250932036-09icc3j1g div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1751250932036-09icc3j1g .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1751250932036-09icc3j1g :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-1751250932036-09icc3j1g .clientSide>\*{fill:#f9f!important;stroke:#333!important;stroke-width:2px!important;}#mermaid-svg-1751250932036-09icc3j1g .clientSide span{fill:#f9f!important;stroke:#333!important;stroke-width:2px!important;}#mermaid-svg-1751250932036-09icc3j1g .serverSide>\*{fill:#bbf!important;stroke:#333!important;stroke-width:2px!important;}#mermaid-svg-1751250932036-09icc3j1g .serverSide span{fill:#bbf!important;stroke:#333!important;stroke-width:2px!important;}#mermaid-svg-1751250932036-09icc3j1g .externalServices>\*{fill:#bfb!important;stroke:#333!important;stroke-width:2px!important;}#mermaid-svg-1751250932036-09icc3j1g .externalServices span{fill:#bfb!important;stroke:#333!important;stroke-width:2px!important;}\</style>\<g>\<marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd">\<path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/>\</marker>\<marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointStart">\<path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/>\</marker>\<marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1751250932036-09icc3j1g\_flowchart-circleEnd">\<circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/>\</marker>\<marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1751250932036-09icc3j1g\_flowchart-circleStart">\<circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/>\</marker>\<marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1751250932036-09icc3j1g\_flowchart-crossEnd">\<path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/>\</marker>\<marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1751250932036-09icc3j1g\_flowchart-crossStart">\<path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/>\</marker>\<g class="root">\<g class="clusters">\<g id="subGraph2" class="cluster default flowchart-label">\<rect height="83.4000015258789" width="333.5875015258789" y="517.0000076293945" x="15.299999237060547" ry="0" rx="0" style=""/>\<g transform="translate(120.7249984741211, 517.0000076293945)" class="cluster-label">\<foreignObject height="18.399999618530273" width="122.73750305175781">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">External Services\</span>\</div>\</foreignObject>\</g>\</g>\<g id="subGraph1" class="cluster default flowchart-label">\<rect height="250.20000457763672" width="354.85625076293945" y="216.8000030517578" x="0" ry="0" rx="0" style=""/>\<g transform="translate(137.35312461853027, 216.8000030517578)" class="cluster-label">\<foreignObject height="18.399999618530273" width="80.1500015258789">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Server Side\</span>\</div>\</foreignObject>\</g>\</g>\<g id="subGraph0" class="cluster default flowchart-label">\<rect height="166.8000030517578" width="225.7624969482422" y="0" x="62.259376525878906" ry="0" rx="0" style=""/>\<g transform="translate(136.44687271118164, 0)" class="cluster-label">\<foreignObject height="18.399999618530273" width="77.38750457763672">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Client Side\</span>\</div>\</foreignObject>\</g>\</g>\</g>\<g class="edgePaths">\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-User LE-Frontend" id="L-User-Frontend-0" d="M175.141,58.4L175.141,62.567C175.141,66.733,175.141,75.067,175.141,82.517C175.141,89.967,175.141,96.533,175.141,99.817L175.141,103.1"/>\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-Frontend LE-API" id="L-Frontend-API-0" d="M175.141,141.8L175.141,145.967C175.141,150.133,175.141,158.467,175.141,166.8C175.141,175.133,175.141,183.467,175.141,191.8C175.141,200.133,175.141,208.467,175.141,215.917C175.141,223.367,175.141,229.933,175.141,233.217L175.141,236.5"/>\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-API LE-QueryService" id="L-API-QueryService-0" d="M175.141,275.2L175.141,279.367C175.141,283.533,175.141,291.867,175.141,299.317C175.141,306.767,175.141,313.333,175.141,316.617L175.141,319.9"/>\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-QueryService LE-TavilyService" id="L-QueryService-TavilyService-0" d="M141.657,358.6L133.303,362.767C124.948,366.933,108.24,375.267,99.886,382.717C91.531,390.167,91.531,396.733,91.531,400.017L91.531,403.3"/>\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-QueryService LE-GeminiService" id="L-QueryService-GeminiService-0" d="M208.624,358.6L216.979,362.767C225.333,366.933,242.041,375.267,250.396,382.717C258.75,390.167,258.75,396.733,258.75,400.017L258.75,403.3"/>\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-TavilyService LE-TavilyAPI" id="L-TavilyService-TavilyAPI-0" d="M91.531,442L91.531,446.167C91.531,450.333,91.531,458.667,91.531,467C91.531,475.333,91.531,483.667,91.531,492C91.531,500.333,91.531,508.667,91.531,516.117C91.531,523.567,91.531,530.133,91.531,533.417L91.531,536.7"/>\<path marker-end="url(#mermaid-svg-1751250932036-09icc3j1g\_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-GeminiService LE-GeminiAPI" id="L-GeminiService-GeminiAPI-0" d="M258.75,442L258.75,446.167C258.75,450.333,258.75,458.667,258.75,467C258.75,475.333,258.75,483.667,258.75,492C258.75,500.333,258.75,508.667,258.75,516.117C258.75,523.567,258.75,530.133,258.75,533.417L258.75,536.7"/>\</g>\<g class="edgeLabels">\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\<g class="edgeLabel">\<g transform="translate(0, 0)" class="label">\<foreignObject height="0" width="0">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="edgeLabel">\</span>\</div>\</foreignObject>\</g>\</g>\</g>\<g class="nodes">\<g transform="translate(91.53125, 558.700008392334)" id="flowchart-TavilyAPI-61" class="node default externalServices flowchart-label">\<rect height="33.39999961853027" width="82.4625015258789" y="-16.699999809265137" x="-41.23125076293945" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-33.73125076293945, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="67.4625015258789">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Tavily API\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(258.75, 558.700008392334)" id="flowchart-GeminiAPI-63" class="node default externalServices flowchart-label">\<rect height="33.39999961853027" width="110.2750015258789" y="-16.699999809265137" x="-55.13750076293945" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-47.63750076293945, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="95.2750015258789">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Gemini AI API\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(175.140625, 258.50000381469727)" id="flowchart-API-53" class="node default serverSide flowchart-label">\<rect height="33.39999961853027" width="81.98750305175781" y="-16.699999809265137" x="-40.993751525878906" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-33.493751525878906, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="66.98750305175781">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">API Layer\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(175.140625, 341.9000053405762)" id="flowchart-QueryService-55" class="node default serverSide flowchart-label">\<rect height="33.39999961853027" width="113.9000015258789" y="-16.699999809265137" x="-56.95000076293945" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-49.45000076293945, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="98.9000015258789">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Query Service\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(91.53125, 425.3000068664551)" id="flowchart-TavilyService-57" class="node default serverSide flowchart-label">\<rect height="33.39999961853027" width="112.2249984741211" y="-16.699999809265137" x="-56.11249923706055" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-48.61249923706055, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="97.2249984741211">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Tavily Service\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(258.75, 425.3000068664551)" id="flowchart-GeminiService-59" class="node default serverSide flowchart-label">\<rect height="33.39999961853027" width="122.2125015258789" y="-16.699999809265137" x="-61.10625076293945" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-53.60625076293945, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="107.2125015258789">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Gemini Service\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(175.140625, 41.70000076293945)" id="flowchart-User-50" class="node default clientSide flowchart-label">\<rect height="33.39999961853027" width="46.80000114440918" y="-16.699999809265137" x="-23.40000057220459" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-15.90000057220459, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="31.80000114440918">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">User\</span>\</div>\</foreignObject>\</g>\</g>\<g transform="translate(175.140625, 125.10000228881836)" id="flowchart-Frontend-51" class="node default clientSide flowchart-label">\<rect height="33.39999961853027" width="155.7624969482422" y="-16.699999809265137" x="-77.8812484741211" ry="0" rx="0" style="" class="basic label-container"/>\<g transform="translate(-70.3812484741211, -9.199999809265137)" style="" class="label">\<rect/>\<foreignObject height="18.399999618530273" width="140.7624969482422">\<div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml">\<span class="nodeLabel">Frontend React App\</span>\</div>\</foreignObject>\</g>\</g>\</g>\</g>\</g>\</svg>